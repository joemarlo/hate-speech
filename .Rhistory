setwd("~/Dropbox/Data/Projects/hate-speech")
source('Plots/ggplot_settings.R')
# read in and combine the data into one flat dataframe
tweets <- map_dfr(list.files("Tweets/Data", pattern = ".json"),
function(file){
# read in the data
tweets_json <- jsonlite::fromJSON(txt = paste0("Tweets/Data/", file))
# convert from nested json to flat df
tweets <- map_dfc(names(tweets_json), function(col){
unlist(tweets_json[[col]])
}) %>%
setNames(names(tweets_json))
return(tweets)
})
tweets
tweets %>%
group_by(handle) %>%
tally() %>%
ggplot(aes(x = n)) +
geom_histogram(color = 'white', bins = 15) +
scale_x_continuous(labels = scales::comma_format()) +
labs(title = 'Tweets collected per user',
subtitle = paste0('n tweets = ', scales::comma_format()(nrow(tweets)), "\n",
'n users = ', scales::comma_format()(n_distinct(tweets$handle))),
x = "Tweets per user",
y = 'Count of users')
tweets %>%
mutate(
Date = as.Date(Date),
Period = as.Date(paste0(lubridate::year(Date), "-",
lubridate::month(Date), "-01"))) %>%
group_by(Period) %>%
tally() %>%
ggplot(aes(x = Period, y = n, color = n)) +
geom_rect(xmin = as.Date("2016-07-01"), xmax = as.Date("2017-12-01"),
ymin = 0, ymax = 15000, alpha = 0.3, fill = 'grey85', size = 0) +
geom_line() +
geom_point() +
scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
scale_y_continuous(labels = scales::comma_format()) +
labs(title = 'Tweets collected per month',
subtitle = paste0('n tweets = ', scales::comma_format()(nrow(tweets)), "\n",
'n users = ', scales::comma_format()(n_distinct(tweets$handle))),
x = NULL,
y = 'Count of tweets per month') +
theme(legend.position = 'none',
axis.text.x = element_text(angle = 40, hjust = 1))
